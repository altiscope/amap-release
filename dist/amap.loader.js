function AMapLoader(n={},o={}){const{preload:t=false,amapUrl:a,version:e}=o;let i=[];(async function(){const{appId:o,insecureHttp:r,apiHost:s}=n;const c=r?"http":"https";let p;try{const n=await fetch(`${c}://${s}/api/v1/configuration/`,{headers:{Authorization:`Token ${o}`,Origin:window.location.origin}});p=await n.json()}catch(n){console.error(n);throw new Error("Error fetching or parsing AMap configuration in AMapLoader")}const d={...n,configuration:p};const w=p.loader?p.loader.amapVersion:"";const l=e||w||"latest";const u=()=>window.AMap!==undefined;if(u()){if(t)return;new window.AMap(d)}else{if(window["__AMap_isLoading"]){i.push(d);return}window["__AMap_isLoading"]=true;const n=document.createElement("script");n.async=true;n.src=a||`https://cdn.jsdelivr.net/gh/altiscope/amap-release@${l}/dist/amap.min.js`;n.onload=function(){if(i.length>0){i.forEach(n=>new window.AMap(n));i=[]}if(t){return}new window.AMap(d)};document.head.appendChild(n)}})()}
